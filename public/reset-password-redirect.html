<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting to App...</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #121212;
            color: #e0e0e0;
        }
        .container {
            text-align: center;
            padding: 20px;
        }
        .spinner {
            border: 3px solid #2a2a2a;
            border-top: 3px solid #1374b9;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="spinner"></div>
        <p>Redirecting to app...</p>
        <p style="font-size: 12px; color: #888; margin-top: 20px;">
            If the app doesn't open, please open it manually.
        </p>
    </div>

    <script>
        (function() {
            // Extract oobCode from URL query parameters
            // Firebase redirects to: https://your-domain.com/reset-password-redirect.html?mode=resetPassword&oobCode=CODE&apiKey=KEY
            const urlParams = new URLSearchParams(window.location.search);
            const oobCode = urlParams.get('oobCode') || urlParams.get('oobcode');
            const mode = urlParams.get('mode');

            // Check if this is a password reset request
            if (oobCode && (mode === 'resetPassword' || mode === 'resetpassword')) {
                // Redirect to app deep link
                const appDeepLink = `aiflashcardapp://reset-password?oobCode=${encodeURIComponent(oobCode)}`;
                
                // Try to open the app using the deep link
                // First attempt: direct redirect
                window.location.href = appDeepLink;
                
                // Also try using a hidden iframe (some mobile browsers need this)
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = appDeepLink;
                document.body.appendChild(iframe);
                
                // Fallback: If app doesn't open after 2.5 seconds, show message with manual link
                setTimeout(function() {
                    const container = document.querySelector('.container');
                    if (container && document.hasFocus()) {
                        // If we still have focus, the app probably didn't open
                        // Create a clickable link as fallback
                        const manualLink = document.createElement('a');
                        manualLink.href = appDeepLink;
                        manualLink.textContent = 'Click here to open the app';
                        manualLink.style.cssText = 'display: inline-block; margin-top: 20px; padding: 12px 24px; background-color: #1374b9; color: white; text-decoration: none; border-radius: 8px; font-weight: bold;';
                        
                        container.innerHTML = `
                            <h2 style="margin: 0 0 16px 0;">Unable to open app automatically</h2>
                            <p>Please tap the button below to open the AI Flashcard App:</p>
                        `;
                        container.appendChild(manualLink);
                        container.innerHTML += `
                            <p style="font-size: 12px; color: #888; margin-top: 20px;">
                                If the button doesn't work, please open the app manually and navigate to the password reset screen.
                            </p>
                            <p style="font-size: 11px; color: #666; margin-top: 30px;">
                                The reset link will be valid for 1 hour.
                            </p>
                        `;
                    }
                }, 2500);
            } else {
                // Missing required parameters
                const container = document.querySelector('.container');
                if (container) {
                    container.innerHTML = `
                        <h2 style="margin: 0 0 16px 0;">Invalid Reset Link</h2>
                        <p>This password reset link is invalid or has expired.</p>
                        <p style="font-size: 12px; color: #888; margin-top: 20px;">
                            Please request a new password reset email from the app.
                        </p>
                    `;
                }
            }
        })();
    </script>
</body>
</html>

